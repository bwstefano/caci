!function o(a,r,i){function s(n,e){if(!r[n]){if(!a[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(c)return c(n,!0);t=new Error("Cannot find module '"+n+"'");throw t.code="MODULE_NOT_FOUND",t}t=r[n]={exports:{}};a[n][0].call(t.exports,function(e){var t=a[n][1][e];return s(t||e)},t,t.exports,o,a,r,i)}return r[n].exports}for(var c="function"==typeof require&&require,e=0;e<i.length;e++)s(i[e]);return s}({1:[function(e,t,n){var u;u=window._,t.exports=function(e){e.controller("TourCtrl",["$scope",function(t){t.total=5,t.step=1,t.nextStep=function(){t.step<t.total&&t.step++},t.prevStep=function(){1<t.step&&t.step--},t.isStep=function(e){return t.step==e}}]),e.controller("MainCtrl",["$q","$rootScope","$scope","$state","$timeout","$cookies","Vindig",function(a,r,s,c,t,i,d){s.base=vindig.base,s.dialogs={},s.showDialog=function(e){return!!s.dialogs[e]},s.toggleDialog=function(e){s.dialogs[e]?s.dialogs[e]=!1:s.dialogs[e]=!0},document.onkeydown=function(e){27==(e=e||window.event).keyCode&&s.$apply(function(){for(var e in s.dialogs)s.dialogs[e]=!1})},d.pages().then(function(e){s.pages=e.data}),s.toggleNav=function(){s.showNav?s.showNav=!1:s.showNav=!0},r.$on("$stateChangeStart",function(e,t,n){s.showNav=!1,n.init&&!s.initialized&&s.init()}),r.$on("mapUpdated",function(e,t){var n=t.getCenter(),o=t.getZoom();(a=[]).push(n.lat),a.push(n.lng),a.push(o);var a=a.join(","),r=s.filter,i=r.strict.uf,t=r.strict.povo,n=r.text,o=r.date.min,r=r.date.max;s.embedUrl=c.href(c.current.name||"home",{...c.params,loc:a,uf:i,povo:t,text:n,date_min:o,date_max:r},{absolute:!0})}),r.$on("updatedFilters",function(e,t){var n=s.filter,o=n.strict.uf,a=n.strict.povo,r=n.text,i=n.date.min,n=n.date.max;s.embedUrl=c.href(c.current.name||"home",{...c.params,uf:o,povo:a,text:r,date_min:i,date_max:n},{absolute:!0})}),s.getEmbedUrl=function(){return encodeURIComponent(s.embedUrl)},s.toggleDossiers=function(){s.showDossiers?s.showDossiers=!1:s.showDossiers=!0},r.$on("$stateChangeStart",function(){s.showDossiers=!1}),s.toggleAdvFilters=function(){s.showAdvFilters?s.showAdvFilters=!1:s.showAdvFilters=!0},r.$on("$stateChangeStart",function(){s.showAdvFilters=!1}),s.home=function(){"home"==c.current.name&&(s.initialized=!1)},s.init=function(){s.initialized=!0,s.showList=!0},s.$watch("initialized",function(e){c.current&&c.current.name&&(e?c.go(c.current.name,{init:!0},{notify:!1}):c.params.init&&c.go(c.current.name,{init:!1},{notify:!1})),t(function(){r.$broadcast("invalidateMap")},200)}),"home.dossier"==c.current.name||"home.dossier.case"==c.current.name?s.isDossier=!0:s.isDossier=!1,"home.case"==c.current.name?s.isCase=!0:s.isCase=!1,r.$on("dossierCases",function(e,t){s.dossierCases=t}),i.get("accessed_tour")||i.put("accessed_tour",0),s.accessedTour=i.get("accessed_tour"),s.disableTour=function(){i.put("accessed_tour",1),s.accessedTour=1},r.$on("$stateChangeSuccess",function(e,t,n,o,a){"home"!==t.name&&(s.initialized=!0),"home.tour"==t.name&&(s.showList=!0,i.put("accessed_tour",1),s.accessedTour=1),o&&"home.case"==o.name&&r.$broadcast("invalidateMap")}),r.$on("$stateChangeStart",function(e,t,n,o){"home.dossier"!=t.name&&"home.dossier.case"!=t.name&&(s.dossierCases=!1),"home.dossier"==t.name||"home.dossier.case"==t.name?s.isDossier=!0:s.isDossier=!1,"home.case"==t.name?s.isCase=!0:s.isCase=!1,(o&&"home.dossier"==o.name&&"home.dossier.case"!=t.name||"home.dossier.case"==o.name&&"home.dossier"!=t.name)&&(s.filter.strict={})}),s.$watch("isDossier",function(e,t){e!==t&&r.$broadcast("invalidateMap")}),s.filtered=[],s.casos=[],s.loading=!0,d.cases().then(function(e){var t=[];s.casos=e.data;for(var n=e.headers("X-WP-TotalPages"),o=2;o<=n;o++)t.push(d.cases({page:o})),t[o-2].then(function(e){e=e.data.map(e=>({...e,...e.meta}));s.casos=s.casos.concat(e)});a.all(t).then(function(){s.loading=!1,r.$broadcast("doneLoading",s)})}),s.itemsPerPage=20,s.currentPage=0,s.prevPage=function(){0<s.currentPage&&s.currentPage--},s.prevPageDisabled=function(){return 0===s.currentPage?"disabled":""},s.pageCount=function(){return Math.ceil(s.filtered.length/s.itemsPerPage)-1},s.nextPage=function(){s.currentPage<s.pageCount()&&s.currentPage++},s.nextPageDisabled=function(){return s.currentPage===s.pageCount()?"disabled":""},r.$on("nextCase",function(e,n){var o;u.each(s.filtered,function(e,t){e.id==n.id&&(o=t)}),0<=o&&s.filtered[o+1]&&c.go("home.case",{caseId:s.filtered[o+1].id})}),r.$on("prevCase",function(e,n){var o;u.each(s.filtered,function(e,t){e.id==n.id&&(o=t)}),0<=o&&s.filtered[o-1]&&c.go("home.case",{caseId:s.filtered[o-1].id})}),r.$on("nextDossier",function(e,n){var o;u.each(s.dossiers,function(e,t){e.id==n.id&&(o=t)}),0<=o&&s.dossiers[o+1]&&c.go("home.dossier",{dossierId:s.dossiers[o+1].id})}),r.$on("prevDossier",function(e,n){var o;u.each(s.dossiers,function(e,t){e.id==n.id&&(o=t)}),0<=o&&s.dossiers[o-1]&&c.go("home.dossier",{dossierId:s.dossiers[o-1].id})}),d.dossiers().then(function(e){s.dossiers=e.data}),s.filter={text:"",strict:{},date:{min:0,max:0}},s.dateFilters=[0,0],s.dropdownFilters={};function n(e){var t=u.sortBy(d.getUniq(e,"ano"),function(e){return parseInt(e)});t.length&&((!s.dateFilters[0]||parseInt(u.min(t))<s.dateFilters[0])&&(s.dateFilters[0]=parseInt(u.min(t)),s.filter.date.min=parseInt(u.min(t))),(!s.dateFilters[1]||parseInt(u.max(t))>s.dateFilters[1])&&(s.dateFilters[1]=parseInt(u.max(t)),s.filter.date.max=parseInt(u.max(t))),s.filter.strict.uf||(s.dropdownFilters.uf=u.sortBy(d.getUniq(e,"uf"),function(e){return e})),s.filter.strict.relatorio||(s.dropdownFilters.relatorio=u.sortBy(d.getUniq(e,"relatorio"),function(e){return e})),s.filter.strict.povo||(s.dropdownFilters.povo=u.sortBy(d.getUniq(e,"povo"),function(e){return e})))}s.$watch("casos",n);r.$on("caseQuery",function(e,t){s.filter.strict=t},!0),s.$watch("casos | filter:filter.text | exact:filter.strict | dateFilter:filter.date | caseIds:dossierCases",function(e){s.filtered=e,n(e),r.$broadcast("updatedFilters",s.filter)},!0);var l=["aldeia","ano","apelido","cod_funai","cod_ibge","coordinates","descricao","dia","mes","ano","fonte_cimi","idade","municipio","uf","nome","povo","relatorio","terra_indigena"];s.downloadCasos=function(e){var o=[];u.each(e,function(t){var n={};u.each(l,function(e){"coordinates"==e&&t.meta._related_point&&t.meta._related_point.length?t.meta[e]=t.meta._related_point[0]._geocode_lon+","+t.meta._related_point[0]._geocode_lat:"coordinates"!=e||t._related_point||(t.meta[e]=""),n[e]=t.meta[e],"string"==typeof n[e]&&(n[e]=n[e].replace(/"/g,'""').replace(/(<([^>]+)>)/gi,""))}),void 0!==t._embedded&&t._embedded["wp:term"][0]&&t._embedded["wp:term"][0].length&&0<t._embedded["wp:term"][0].length&&u.each(t._embedded["wp:term"][0],function(e){void 0===n.tipos_de_violencia?n.tipos_de_violencia=e.name:n.tipos_de_violencia=n.tipos_de_violencia+", "+e.name,e.taxonomy}),o.push(n)}),JSONToCSV(o,"casos",!0)},s.clearFilters=function(){s.filter.text="","undefined"!=typeof anos&&anos&&anos.length&&(s.filter.date.min=parseInt(u.min(anos)),s.filter.date.max=parseInt(u.max(anos))),s.filter.strict={}},s.$on("$stateChangeSuccess",function(e,t,n,o,a){o&&"home.dossier"==t.name&&"home.dossier.case"!=o.name&&s.clearFilters()}),s.focusMap=function(e){e=e.meta._related_point[0],e=[e._geocode_lon,e._geocode_lat];r.$broadcast("focusMap",e)},s.showList=!1,s.toggleCasos=function(){s.showList?s.showList=!1:s.showList=!0},s.$watch("showList",function(){t(function(){r.$broadcast("invalidateMap")},300)})}]),e.controller("HomeCtrl",["$scope","$rootScope","$timeout","Map",function(n,e,t,o){n.$on("$stateChangeSuccess",function(e,t){"home"!=t.name&&"home.tour"!=t.name&&"home.case"!=t.name&&"home.page"!=t.name||(n.mapData=o)}),n.$on("dossierMap",function(e,t){n.mapData=t})}]),e.controller("DossierCtrl",["$rootScope","$timeout","$scope","$sce","Dossier","DossierMap","$state",function(e,t,n,o,a,r,i){var s;n.url=i.href("home.dossier",{id:a.data.id},{absolute:!0}),n.dossier=a.data,n.dossier.content=o.trustAsHtml(n.dossier.content.rendered),n.dossier.title=o.trustAsHtml(n.dossier.title.rendered),n.dossier._embedded.author&&n.dossier._embedded.author.length&&(n.dossier.author=n.dossier._embedded.author[0]),n.dossier.excerpt=o.trustAsHtml(n.dossier.excerpt.rendered),n.$emit("dossierMap",r),t(function(){e.$broadcast("invalidateMap")},300),n.dossier.meta.casos&&n.dossier.meta.casos.length&&""!=n.dossier.meta.casos[0]?e.$broadcast("dossierCases",n.dossier.meta.casos):n.dossier.meta.casos_query&&(t=n.dossier.meta.casos_query.split(";"),s={},u.each(t,function(e){e&&(kv=e.split("="),kv.length&&(0==kv[1].indexOf("/")?s[kv[0].trim()]=new RegExp(kv[1].substring(1,kv[1].length-1)):s[kv[0].trim()]=kv[1].replace(/"/g,"")))}),e.$broadcast("caseQuery",s)),n.base=vindig.base,n.hiddenContent=!1,n.shareParams={title:n.dossier.title,url:encodeURIComponent(n.url)},n.close=function(){n.hiddenContent=!0,n.showList=!1;let e=document.getElementById("dossies");e.classList.add("active"),i.go("home")},n.next=function(){e.$broadcast("nextDossier",n.dossier)},n.prev=function(){e.$broadcast("prevDossier",n.dossier)}}]),e.controller("CaseCtrl",["$rootScope","$state","$stateParams","$scope","$sce","$filter","Case","Vindig",function(e,t,n,o,a,r,i,s){o.url=t.href("home.case",{id:i.data.id},{absolute:!0}),i.data={...i.data,...i.data.meta,coordinates:[i.data.meta._related_point[0]._geocode_lon,i.data.meta._related_point[0]._geocode_lat]},o.caso=i.data,o.caso.content=a.trustAsHtml(o.caso.content.rendered),o.caso.descricao=a.trustAsHtml(o.caso.descricao),0!=n.focus&&e.$broadcast("focusMap",o.caso.coordinates),e.$broadcast("invalidateMap"),o.report=function(e){s.report(o.caso.id,e).success(function(e){o.reported=!0}).error(function(e){console.log(e)})},o.close=function(){-1!==t.current.name.indexOf("dossier")?t.go("home.dossier",t.current.params):t.go("home")},o.next=function(){e.$broadcast("nextCase",o.caso)},o.prev=function(){e.$broadcast("prevCase",o.caso)},o.shareParams={title:r("casoName")(o.caso),url:encodeURIComponent(o.url)}}]),e.controller("PageCtrl",["$scope","$sce","Page","Vindig",function(t,e,n,o){t.page=n.data,console.log("Page.data",n.data),t.page.content=e.trustAsHtml(t.page.content.rendered),t.contacted=!1,t.contacting=!1,t.contact=function(e){t.contacting||(t.contacting=!0,o.contact(e).success(function(e){t.contacted=!0,t.contacting=!1}).error(function(e){console.log(e)}))}}])}},{}],2:[function(e,t,n){var o,I,P;o=window.vindig,I=window.jQuery,(P=window.L).mapbox.accessToken="pk.eyJ1IjoiaW5mb2FtYXpvbmlhIiwiYSI6InItajRmMGsifQ.JnRnLDiUXSEpgn7bPDzp7g",t.exports=function(e){e.directive("tourFocus",[function(){return{restrict:"A",scope:{sel:"=tourFocus",direction:"=",active:"="},link:function(e,t,n){var o,a,r,i=I(e.sel),s=I(t),c=s.find(".step-description"),d=s.find(".arrow");s.addClass(e.direction);function l(){o=i.innerWidth(),a=i.innerHeight(),r=i.offset(),s.css({width:o,height:a,top:r.top,left:r.left}),"right"==e.direction?(c.css({top:r.top-10,left:r.left,"margin-left":-320}),d.css({top:r.top,left:r.left,"margin-top":10,"margin-left":-40})):"left"==e.direction?(c.css({top:r.top-10,left:o,"margin-left":30}),d.css({top:r.top,left:o,"margin-top":10,"margin-left":20})):"top"==e.direction?(c.css({bottom:I(window).height()-r.top+30,left:u(r.left+o/2-145)}),d.css({bottom:I(window).height()-r.top,left:r.left+o/2,"margin-bottom":20,"margin-left":-10})):"bottom"==e.direction&&(c.css({top:r.top+a,left:u(r.left+o/2-145),"margin-top":30}),d.css({top:r.top+a,left:r.left+o/2,"margin-top":20,"margin-left":-10}))}function u(e){return max=I(window).width()-c.innerWidth(),e<0?0:e>max?max:e}l(),e.$watch("active",_.debounce(function(){l()},400)),I(window).resize(l)}}}]),e.directive("scrollUp",[function(){return{restrict:"A",scope:{scrollUp:"="},link:function(e,t,n){var o=I(e.scrollUp);I(t).on("click",function(){o.scrollTop(0)})}}}]),e.directive("attachToContent",[function(){return{restrict:"A",scope:{sel:"=attachToContent"},link:function(e,t,n){var o=I(e.sel||".single");I(window).resize(function(){I(t).css({left:o.offset().left+o.width()+"px"})}),I(window).resize()}}}]),e.directive("tagExternal",["$timeout",function(o){return{restrict:"A",link:function(e,t,n){o(function(){I(t).find("a").each(function(){var e;I(this).parents(".share").length||("string"==typeof(e=(e=I(this).attr("href")).match(/^([^:\/?#]+:)?(?:\/\/([^\/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/))[1]&&0<e[1].length&&e[1].toLowerCase()!==location.protocol||"string"==typeof e[2]&&0<e[2].length&&e[2].replace(new RegExp(":("+{"http:":80,"https:":443}[location.protocol]+")?$"),"")!==location.host)&&I(this).addClass("external").attr({rel:"external",target:"_blank"})})},200)}}}]),e.directive("forceOnclick",[function(){return{restrict:"A",scope:{forceOnclick:"=",forceParent:"@"},link:function(e,t,n){function o(e){r.removeClass("force"),e.type&&"mousemove"==e.type&&I(document).unbind("mousemove",o)}var a=e.forceOnclick||500,r=e.forceParent?I("#"+e.forceParent):I(t);I(t).on("click",function(){r.addClass("force"),"move"==a?I(document).on("mousemove",o):setTimeout(o,a)})}}}]),e.directive("map",["$rootScope","$state","Vindig",function(x,b,C){return{restrict:"E",scope:{mapData:"=",markers:"=",heatMarker:"="},link:function(o,e,t){function n(){var e=s.getCenter(),t=s.getZoom(),n=[];return n.push(e.lat),n.push(e.lng),n.push(t),n.join(",")}angular.element(e).append('<div id="'+t.id+'"></div>').attr("id","");var a=b.params.loc?b.params.loc.split(","):[],r=[0,0],e=2;a.length&&(r=[a[0],a[1]],e=a[2]),x.$on("doneLoading",function(e,t){var n=function(){const e={};return b.params.uf&&(e.uf=b.params.uf),b.params.povo&&(e.povo=b.params.povo),b.params.text&&(e.text=b.params.text),b.params.date_min&&(e.date_min=b.params.date_min),b.params.date_max&&(e.date_max=b.params.date_max),e}();const o=t.filter;n.uf&&(o.strict.uf=n.uf),n.povo&&(o.strict.povo=n.povo),n.text&&(o.text=n.text),(n.date_min||n.date_max)&&(o.date={min:parseInt(n.date_min),max:parseInt(n.date_max)}),x.$broadcast("updatedFilters",o)},!0);var i,s=P.map(t.id,{fullscreenControl:!0,center:r,zoom:e,maxZoom:18});s.attributionControl.setPrefix("");var c=!0;x.$on("$stateChangeStart",function(){c=!1}),x.$on("$stateChangeSuccess",function(){c=!0}),s.on("move",_.debounce(function(){o.$emit("mapUpdated",s),o.$apply(function(){c&&(n()!=i&&b.go(b.current.name,{loc:n()},{notify:!1,location:"replace"}),i=n())})},1e3)),x.$on("invalidateMap",function(){setTimeout(function(){s.invalidateSize(!0)},15)}),x.$on("focusMap",function(e,t){s.fitBounds(P.latLngBounds([[t[1],t[0]]]))});var d=o.mapData=!1;o.$watch("mapData",function(e,t){var n;e.id===t.id&&d||(d=!0,(n=e.meta).layers,o.layers=e.layers,setTimeout(function(){n.min_zoom?s.options.minZoom=parseInt(n.min_zoom):s.options.minZoom=1,n.max_zoom?s.options.maxZoom=parseInt(n.max_zoom):s.options.maxZoom=18,a.length||setTimeout(function(){s.setView({lat:n.center_lat,lon:n.center_lon},n.initial_zoom,{reset:!0}),s.setZoom(n.initial_zoom),setTimeout(function(){s.setView({lat:n.center_lat,lon:n.center_lon},n.initial_zoom,{reset:!0}),s.setZoom(n.initial_zoom)},100)},200),setTimeout(function(){e.pan_limits?s.setMaxBounds(P.latLngBounds([e.pan_limits.south,e.pan_limits.west],[e.pan_limits.north,e.pan_limits.east])):s.setMaxBounds(P.latLngBounds(["-49.49667452747043","-128.671875"],["29.38217507514529","0.87890625"]))},400)},200))});var l,u=P.divIcon({className:"icon icon-caution",iconSize:[18,18],iconAnchor:[9,18],popupAnchor:[0,-18]}),m=P.markerClusterGroup({zIndex:100,maxClusterRadius:20,polygonOptions:{fillColor:"#000",color:"#000",opacity:.3,weight:2},spiderLegPolylineOptions:{weight:1,color:"#222",opacity:.4},iconCreateFunction:function(e){e=e.getChildCount();let t="marker-cluster marker-cluster-",n=0;return n=e<10?(t+="small",22):e<100?(t+="medium",27):(t+="large",36),P.divIcon({html:`<div><span> ${e}</span></div>`,className:t,iconSize:new P.Point(n,n)})}});m.addTo(s),o.heatMarker&&(l=P.heatLayer([],{blur:30})).addTo(s);var p=[],f=[];o.$watch("markers",_.debounce(function(e){for(var t in p)m.removeLayer(p[t]);for(var t in p=[],f=[],e){var n=e[t];f.push([n.lat,n.lng]),p[t]=P.marker([n.lat,n.lng],{icon:u}),p[t].post=n,p[t].bindPopup(n.message),p[t].on("mouseover",function(e){e.target.openPopup()}),p[t].on("mouseout",function(e){e.target.closePopup()}),p[t].on("click",function(e){var t=_.extend({focus:!1},e.target.post.state.params),e="home.case";-1!==b.current.name.indexOf("dossier")&&(e="home.dossier.case"),b.go(e,t)})}for(var t in p)p[t].addTo(m);o.heatMarker&&l.setLatLngs(f)},300),!0),o.layers=[];var g=[],h=[],v=[],$={},e=!1;I(window).width()<=768&&(e=!0);var w=P.control.layers({},{},{collapsed:e,position:"bottomright",autoZIndex:!1}).addTo(s),y=P.mapbox.legendControl().addTo(s);w.addOverlay(m,"Casos de violência"),s.on("layeradd",function(e){e.layer._vindig_id&&($[e.layer._vindig_id].control&&s.addControl($[e.layer._vindig_id].control),$[e.layer._vindig_id].legend&&y.addLegend($[e.layer._vindig_id].legend))}),s.on("layerremove",function(e){e.layer._vindig_id&&($[e.layer._vindig_id].control&&s.removeControl($[e.layer._vindig_id].control),$[e.layer._vindig_id].legend&&y.removeLegend($[e.layer._vindig_id].legend))}),o.$watch("layers",function(e,t){e===t&&!_.isEmpty($)||(t&&t.length&&(g.length&&(_.each(g,function(e){s.removeLayer(e.layer)}),g=[]),h.length&&(_.each(h,function(e){w.removeLayer(e.layer),s.hasLayer(e.layer)&&s.removeLayer(e.layer)}),h=[]),v.length&&(_.each(v,function(e){w.removeLayer(e.layer),s.hasLayer(e.layer)&&s.removeLayer(e.layer)}),v=[])),e&&e.length&&(_.each(e,function(e,t){e.zIndex=t+10,e.ID=e.ID||"base",$[e.ID]&&"base"!=e.ID||($[e.ID]=C.getLayer(e,s)),"fixed"!=e.filtering&&e.filtering?"swap"==e.filtering?(e.first_swap&&s.addLayer($[e.ID].layer),h.push($[e.ID])):"switch"==e.filtering&&(e.hidden||s.addLayer($[e.ID].layer),v.push($[e.ID])):(g.push($[e.ID]),s.addLayer($[e.ID].layer))}),h=h.reverse(),_.each(h,function(e){w.addBaseLayer(e.layer,e.name)}),v=v.reverse(),_.each(v,function(e){w.addOverlay(e.layer,e.name)})))})}}}]),e.directive("customSharer",function(){return{restrict:"E",templateUrl:o.base+"/views/sharer.html"}})}},{}],3:[function(e,t,n){var s;s=window._,t.exports=function(e){e.filter("emptyToEnd",function(){return function(e,t){if(angular.isArray(e)){var n=e.filter(function(e){return e[t]}),e=e.filter(function(e){return!e[t]});return n.concat(e)}}}),e.filter("offset",function(){return function(e,t){return t=parseInt(t,10),e.slice(t)}}),e.filter("exact",function(){return function(e,t){var a,n=[],o=!0;return angular.forEach(t,function(e,t){o=o&&!e}),o?e:(angular.forEach(e,function(o){a=!0,angular.forEach(t,function(e,t){var n;e&&(a=0==e.indexOf("^")?(n=new RegExp(e),a&&n.test(o[t])):a&&o[t]===e)}),a&&n.push(o)}),n)}}),e.filter("caseIds",function(){return function(e,t){return e=t&&t.length?s.filter(e,function(e){return-1!=t.indexOf(e.id)}):e}}),e.filter("casoName",[function(){return function(e){var t=e.meta,e="";return t&&(t.nome?(e+=t.nome,t.apelido&&(e+=" ("+t.apelido+")")):t.apelido?e+=t.apelido:e+="Não identificado"),e}}]),e.filter("casoDate",["$sce",function(n){return function(e){var t=e.meta,e="";return t.ano&&(e='<span class="ano">'+t.ano+"</span>"),t.mes&&(e+='<span class="mes">/'+t.mes+"</span>"),t.dia&&(e+='<span class="dia">/'+t.dia+"</span>"),n.trustAsHtml(e)}}]),e.filter("dossieExcerpt",["$sce",function(t){return function(e){return t.trustAsHtml(e.excerpt.rendered)}}]),e.filter("caseLocation",["$sce",function(a){return function(e,t,n){var o="",e=e.meta;return e.terra_indigena&&(o=t?'<span class="ti"><span class="label">Terra indígena</span> '+e.terra_indigena+`${n?", ":" "}</span>`:'<span class="ti">'+e.terra_indigena+`${n?", ":" "}</span>`),e.municipio&&(o+=t?'<span class="mun"><span class="label">Município</span> '+e.municipio+`${n?" - ":" "}</span>`:'<span class="mun"> '+e.municipio+`${n?" - ":" "}</span>`),e.uf&&(o+=t?'<span class="uf"><span class="label">Estado</span> '+e.uf+"</span>":'<span class="uf">'+e.uf+"</span>"),a.trustAsHtml(o)}}]),e.filter("dateFilter",[function(){return function(e,t){return e=e&&e.length?s.filter(e,function(e){e=parseInt(e.meta.ano);return e>=t.min&&e<=t.max}):e}}]),e.filter("postToMarker",["casoNameFilter","$state",function(r,i){return s.memoize(function(e,t,n){var o="";if(i.current.name==n?o+=n+".":t&&(o+=t+"."),e&&e.length){var a={};return s.each(e,function(e){var t=e.meta;t._related_point&&t._related_point.length&&(t=t._related_point[0],params={},params[e.type+"Id"]=e.id,a[e.id]={lat:t._geocode_lat,lng:t._geocode_lon,message:"<h2>"+r(e)+"</h2>",state:{name:o+e.type,params:params}})}),a}return{}},function(){return JSON.stringify(arguments)})}])}},{}],4:[function(e,t,n){var a,r,o;e("./util"),a=window.angular,r=window.vindig,(o=a.module("vindigena",["ui.router","ngCookies","djds4rce.angular-socialshare","ui-rangeSlider","fitVids"],["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|whatsapp|file):/)}])).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(e,t,n,o){n.html5Mode({enabled:!1,requireBase:!1}),n.hashPrefix("!"),e.state("home",{url:"/?loc&init&uf&text&date_min&date_max&povo",controller:"HomeCtrl",templateUrl:r.base+"/views/index.html",reloadOnSearch:!1,resolve:{Map:["$q","Vindig",function(e,t){var n=e.defer();return r.featured_map?t.getMap(r.featured_map).then(function(e){n.resolve(e.data)}):t.maps().then(function(e){n.resolve(e.data[0])}),n.promise}]}}).state("home.tour",{url:"tour/",controller:"TourCtrl",templateUrl:r.base+"/views/tour.html",reloadOnSearch:!1}).state("home.page",{url:"p/:id/",controller:"PageCtrl",templateUrl:r.base+"/views/page.html",reloadOnSearch:!1,resolve:{Page:["$stateParams","Vindig",function(e,t){return console.log(e,e),t.getPage(e.id)}]}}).state("home.case",{url:"caso/:caseId/",controller:"CaseCtrl",templateUrl:r.base+"/views/case.html",reloadOnSearch:!1,params:{focus:!0},resolve:{Case:["$stateParams","Vindig",function(e,t){return t.getCase(e.caseId)}]}}).state("home.dossier",{url:"dossie/:dossierId/",controller:"DossierCtrl",templateUrl:r.base+"/views/dossier.html",reloadOnSearch:!1,resolve:{Dossier:["$stateParams","Vindig",function(e,t){return t.getDossier(e.dossierId)}],DossierMap:["$q","Dossier","Vindig",function(e,t,n){var t=t.data.meta.maps.length?t.data.meta.maps[0]:r.featured_map,o=e.defer();return n.getMap(t).then(function(e){o.resolve(e.data)}),o.promise}]}}).state("home.dossier.case",{url:":caseId/",controller:"CaseCtrl",templateUrl:r.base+"/views/case.html",params:{focus:!0},reloadOnSearch:!1,resolve:{Case:["$stateParams","Vindig",function(e,t){return t.getPost(e.caseId)}]}}),t.rule(function(e,t){var n,o=t.path(),t=t.search();if("/"!==o[o.length-1])return 0===Object.keys(t).length?o+"/":(n=[],a.forEach(t,function(e,t){n.push(t+"="+e)}),o+"/?"+n.join("&"))})}]).run(["$rootScope","$window","$location","$FB",function(e,r,i,t){t.init("1496777703986386"),e.$on("$stateChangeSuccess",function(e,t,n,o,a){r._gaq&&r._gaq.push(["_trackPageview",i.path()]),o.name&&-1==o.name.indexOf("dossier")&&-1==t.name.indexOf("dossier")&&jQuery("html,body").animate({scrollTop:0},400)})}]),e("./services")(o),e("./filters")(o),e("./directives")(o),e("./controllers")(o),a.element(document).ready(function(){a.bootstrap(document,["vindigena"])})},{"./controllers":1,"./directives":2,"./filters":3,"./services":5,"./util":6}],5:[function(e,t,n){var o,r;o=window.vindig,r=window.L,t.exports=function(e){e.config(["$httpProvider",function(e){e.defaults.paramSerializer="$httpParamSerializerJQLike"}]),e.factory("Vindig",["$http",function(n){return{pages:function(e,t){return e=e||{},e=_.extend(e),t=t||{},t=_.extend({posts_per_page:50,orderby:"menu_order",order:"ASC"},t),e.filter=t,n({method:"GET",url:o.api+"/pages",params:e})},maps:function(e,t){return e=e||{},e=_.extend({type:"map"},e),t=t||{},t=_.extend({posts_per_page:50},t),e.filter=t,n({method:"GET",url:o.api+"/posts",params:e})},cases:function(e,t){return e=e||{},e=_.extend(e),t=t||{},t=_.extend({posts_per_page:40,without_map_query:1},t),e.filter=t,e._embed=1,n({method:"GET",url:o.api+"/case",params:e})},report:function(e,t){return n({method:"POST",url:o.api+"/posts/"+e+"/denuncia",data:{message:t}})},contact:function(e){return n({method:"POST",url:o.api+"/contact",data:e})},dossiers:function(e,t){return e=e||{},e=_.extend(e),t=t||{},t=_.extend({posts_per_page:50,without_map_query:1},t),e.filter=t,n({method:"GET",url:o.api+"/dossier",params:e})},getLayer:function(e,t){var n,o,a={name:e.title||""};return"mapbox"==e.type?(n=r.mapbox.tileLayer(e.mapbox_id),o=r.mapbox.gridLayer(e.mapbox_id),a.layer=r.layerGroup([n,o]),a.control=r.mapbox.gridControl(o)):"tilelayer"==e.type&&(a.layer=r.tileLayer(e.tile_url)),e.legend&&(a.legend=e.legend),a.layer&&(e.zIndex&&a.layer.setZIndex(e.zIndex),a.layer._vindig_id=e.ID),a},getPost:function(e){return n.get(o.api+"/posts/"+e)},getPage:function(e){return console.log(e),n.get(o.api+"/pages/"+e)},getDossier:function(e){return n({method:"GET",url:o.api+`/dossier/${e}`,params:{_embed:!0}})},getCase:function(e){return n.get(o.api+"/case/"+e)},getMap:function(e){return n.get(o.api+"/map/"+e)},getUniq:function(e,t,n){var o=[];if(_.each(e,function(e){e.meta[t]&&(angular.isArray(e.meta[t])?e.meta[t].length&&(o=o.concat(e.meta[t])):o.push(e.meta[t]))}),o.length){e=_.uniq(o,function(e,t){return void 0!==n&&e[n]?e[n]:e});return _.compact(e)}return[]}}}])}},{}],6:[function(e,t,n){window.JSONToCSV=function(e,t,n){var o="object"!=typeof e?JSON.parse(e):e,a="";if(n){var r="";for(s in o[0])r+=s+",";a+=(r=r.slice(0,-1))+"\r\n"}for(var i=0;i<o.length;i++){var s,r="";for(s in o[i])r+='"'+o[i][s]+'",';r.slice(0,r.length-1),a+=r+"\r\n"}""!=a?(e=t.replace(/ /g,"_"),n="data:text/csv;charset=utf-8,"+encodeURIComponent(a),(t=document.createElement("a")).href=n,t.style="visibility:hidden",t.download=e+".csv",document.body.appendChild(t),t.click(),document.body.removeChild(t)):alert("Invalid data")},window.onload=function(){let t=document.getElementById("dossies");document.querySelectorAll(".dossiers-items li article h3 a").forEach(e=>{e.addEventListener("click",e=>{t.classList.remove("active")})})}},{}]},{},[4]);
//# sourceMappingURL=app.js.map